<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Schedule Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: #f8f9fa;
            min-height: 100vh;
        }

        /* Navbar */
        .navbar {
            background: #41644A;
            padding: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            height: 70px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.3em;
            font-weight: 600;
            color: white;
            padding: 0 25px;
            display: flex;
            align-items: center;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
        }

        .nav-links {
            display: flex;
            align-items: center;
            list-style: none;
            margin: 0;
            height: 100%;
            padding: 0;
            flex-grow: 1;
            justify-content: center;
            gap: 5px;
        }

        .nav-links li {
            height: 100%;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 0 15px;
            font-size: 0.9em;
            height: 100%;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            gap: 5px;
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background: #E9772B;
            transition: width 0.3s ease;
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .logout-container {
            padding: 0 15px;
            height: 100%;
            display: flex;
            align-items: center;
        }

        .logout-btn {
            background: #E9772B;
            color: white;
            padding: 8px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background: #d66a24;
            transform: translateY(-2px);
        }

        .logout-btn i {
            font-size: 0.9em;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Page Title */
        .page-title {
            color: #41644A;
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            padding-bottom: 15px;
        }

        .page-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: #E9772B;
            border-radius: 3px;
        }

        /* Schedule Grid */
        .schedule-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: auto repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .time-slot {
            padding: 10px;
            text-align: center;
            font-weight: 500;
            color: #41644A;
        }

        .day-header {
            background: #41644A;
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            font-weight: 500;
        }

        .schedule-cell {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            min-height: 100px;
            transition: all 0.3s ease;
            cursor: default;
            position: relative;
        }

        .schedule-cell.occupied {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }

        .room-info {
            font-weight: 600;
            color: #41644A;
            text-align: center;
            font-size: 1.1em;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .delete-btn {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: rgba(220, 53, 69, 0.1);
            transform: scale(1.1);
        }

        .schedule-cell:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .schedule-cell.occupied:hover {
            transform: translateY(-2px);
        }

        /* Add Schedule Form */
        .add-schedule-form {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #41644A;
            font-weight: 500;
        }

        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            background-color: white;
            cursor: pointer;
        }

        .form-group select:focus {
            outline: none;
            border-color: #41644A;
            box-shadow: 0 0 0 2px rgba(65, 100, 74, 0.1);
        }

        .form-group select option {
            padding: 10px;
        }

        .section-title {
            color: #41644A;
            font-size: 1.5em;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #E9772B;
        }

        .submit-btn {
            background: #41644A;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .submit-btn:hover {
            background: #2d4432;
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .schedule-grid {
                font-size: 0.9em;
            }
        }

        @media (max-width: 992px) {
            .navbar {
                height: auto;
                padding: 10px;
                flex-direction: column;
            }

            .schedule-grid {
                grid-template-columns: 1fr;
            }

            .day-header {
                display: none;
            }

            .schedule-cell {
                display: flex;
                flex-direction: column;
            }

            .schedule-cell::before {
                content: attr(data-day);
                font-weight: 500;
                margin-bottom: 5px;
                color: #41644A;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-group {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="logo">Admin Dashboard</div>
        <ul class="nav-links">
            <li><a href="{{ url_for('admin_dashboard') }}"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="{{ url_for('search') }}"><i class="fas fa-search"></i> Search</a></li>
            <li><a href="{{ url_for('students') }}"><i class="fas fa-users"></i> Students</a></li>
            <li><a href="{{ url_for('current_sit_in') }}"><i class="fas fa-chair"></i> Sit-in</a></li>
            <li><a href="{{ url_for('sit_in_records') }}"><i class="fas fa-history"></i> Records</a></li>
            <li><a href="{{ url_for('sit_in_report') }}"><i class="fas fa-chart-bar"></i> Reports</a></li>
            <li><a href="{{ url_for('feedback_report') }}"><i class="fas fa-comments"></i> Feedback</a></li>
            <li><a href="{{ url_for('reservation') }}"><i class="fas fa-calendar-alt"></i> Reservation</a></li>
            <li><a href="{{ url_for('leaderboard') }}"><i class="fas fa-trophy"></i> Leaderboard</a></li>
            <li><a href="{{ url_for('admin_resources') }}"><i class="fas fa-laptop-code"></i> Lab Resources</a></li>
            <li><a href="{{ url_for('adminlabschedule') }}"><i class="fas fa-laptop-code"></i> adminlabschedule</a></li>
            <li><a href="{{ url_for('computer_control') }}"><i class="fas fa-laptop-code"></i> computer control</a></li>
        </ul>
        </ul>
        <div class="logout-container">
            <a href="{{ url_for('logout') }}" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </a>
        </div>
    </div>

    <div class="container">
        <h1 class="page-title">Lab Schedule Management</h1>

        <!-- Schedule Grid -->
        <div class="schedule-container">
            <div class="schedule-grid">
                <div class="time-slot"></div>
                {% for day in days %}
                    <div class="day-header">{{ day }}</div>
                {% endfor %}

                {% for time in time_slots %}
                    <div class="time-slot">{{ time }}</div>
                    {% for day_index in range(5) %}
                        <div class="schedule-cell{% if schedules[day_index][loop.index0] %} occupied{% endif %}"
                             data-day="{{ days[day_index] }}"
                             data-time="{{ time }}">
                            {% if schedules[day_index][loop.index0] %}
                                <div class="room-info">
                                    Lab {{ schedules[day_index][loop.index0].room }}
                                    <button class="delete-btn" onclick="deleteSchedule(this)" title="Delete Schedule">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>
        </div>

        <!-- Add Schedule Form -->
        <div class="add-schedule-form">
            <h2 class="section-title">Add New Schedule</h2>
            <form id="scheduleForm" action="{{ url_for('add_schedule') }}" method="POST">
                <div class="form-row">
                    <div class="form-group">
                        <label for="day">Day:</label>
                        <select id="day" name="day" required>
                            <option value="">Select Day</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="time">Time Slot:</label>
                        <select id="time" name="time" required>
                            <option value="">Select Time</option>
                            <option value="7:30 AM - 9:00 AM">7:30 AM - 9:00 AM</option>
                            <option value="9:00 AM - 10:30 AM">9:00 AM - 10:30 AM</option>
                            <option value="10:30 AM - 12:00 PM">10:30 AM - 12:00 PM</option>
                            <option value="1:00 PM - 2:30 PM">1:00 PM - 2:30 PM</option>
                            <option value="2:30 PM - 4:00 PM">2:30 PM - 4:00 PM</option>
                            <option value="4:00 PM - 5:30 PM">4:00 PM - 5:30 PM</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="room">Lab Room:</label>
                        <select id="room" name="room" required>
                            <option value="">Select Lab</option>
                            <option value="544">Lab 544</option>
                            <option value="542">Lab 542</option>
                            <option value="530">Lab 530</option>
                            <option value="526">Lab 526</option>
                            <option value="524">Lab 524</option>
                            <option value="517">Lab 517</option>
                            <option value="528">Lab 528</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-plus"></i>
                    Add Schedule
                </button>
            </form>
        </div>
    </div>

    <script>
        function updateScheduleGrid(schedules) {
            // Clear all cells first
            document.querySelectorAll('.schedule-cell').forEach(cell => {
                cell.classList.remove('occupied');
                cell.innerHTML = '';
            });

            // Update cells with schedules
            schedules.forEach(schedule => {
                const cell = document.querySelector(
                    `.schedule-cell[data-day="${schedule.day}"][data-time="${schedule.time_slot}"]`
                );
                if (cell) {
                    cell.classList.add('occupied');
                    cell.innerHTML = `
                        <div class="room-info">
                            Lab ${schedule.room}
                            <button class="delete-btn" onclick="deleteSchedule(this)" title="Delete Schedule">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                }
            });
        }

        function deleteSchedule(button) {
            if (!confirm('Are you sure you want to delete this schedule?')) {
                return;
            }

            const cell = button.closest('.schedule-cell');
            const day = cell.dataset.day;
            const time = cell.dataset.time;

            const formData = new FormData();
            formData.append('day', day);
            formData.append('time', time);

            fetch('/delete_schedule', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update the grid with the new schedule data
                    updateScheduleGrid(data.schedules);
                } else {
                    alert('Failed to delete schedule: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while deleting the schedule.');
            });
        }

        function initializeFormHandlers() {
            const form = document.getElementById('scheduleForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();

                const formData = new FormData(form);
                
                fetch('/add_schedule', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message
                        alert(data.message);
                        // Update the grid with the new schedule data
                        updateScheduleGrid(data.schedules);
                        form.reset();
                    } else {
                        alert('Failed to add schedule: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while adding the schedule.');
                });
            });
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Get initial schedules from the server
            fetch('/get_schedules')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateScheduleGrid(data.schedules);
                    }
                })
                .catch(error => {
                    console.error('Error fetching schedules:', error);
                });

            initializeFormHandlers();
        });
    </script>
</body>
</html>
